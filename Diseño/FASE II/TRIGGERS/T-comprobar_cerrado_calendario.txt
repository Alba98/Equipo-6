CREATE OR REPLACE TRIGGER COMPROBAR_CERRADO_CALENDARIO

BEFORE INSERT  OR UPDATE OR INSERT ON TEMPORADAS
FOR EACH ROW
  
  DECLARE
  V_CERRAR TEMPORADAS.ABIERTA%TYPE;
  E_CALENDARIOCERRADO EXCEPTION;
  
  CURSOR TEMP_CURSOR IS(
  
  SELECT ABIERTA 
  FROM TEMPORADAS
  WHERE COD_TEMPORADA= :NEW.COD_TEMPORADA
    
  );
  
  BEGIN
  OPEN  TEMP_CURSOR;
  LOOP
   FETCH TEMP_CURSOR INTO  V_CERRAR ;
   EXIT WHEN TEMP_CURSOR%NOTFOUND;
  END LOOP;

  IF UPPER(V_CERRAR)='S' THEN
  RAISE  E_CALENDARIOCERRADO; 
  
  END IF;
  
  EXCEPTION
  
  
  WHEN E_CALENDARIOCERRADO THEN
  RAISE_APPLICATION_ERROR (-20123,'Error.El calendario est√° cerrado');
  
  END COMPROBAR_CERRADO_CALENDARIO;